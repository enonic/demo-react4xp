= React4XP project starter
:toc: right
:imagesdir: media/

Build sites and apps that support client- and serverside JSX templating with the React framework, in combination with optimized asset serving and hydration - for lighting fast sites and apps.

React4XP integrates React with the CMS components in Content Studio, and allows reuse of JSX templates for both back-end, front-end and editorial use cases. It builds directly on top of traditional XP controllers, making JSX look like any other templating engine out there, while expanding the possibilities for single-page sites and client-side driven apps when needed.

== Introduction

This documentation takes you through the basic elements of React4XP and how to use the starter, helping you kickstart a React4xp project of your own.

Essential features you will learn about:

* How to
* What is
* And then some...

[NOTE]
====
This starter and guide aims for setting up React4xp with *XP 7*. An XP6-compatible version will be released shortly. If you're using XP6 and the XP6 starter, only the installation is different from XP7 - and the XP6 starter handles those differences. Using React4xp the rest of the way is identical, so you can still use this guide for both versions.

=== What is React4xp?

React4xp is a suite of tools: a library with a few companion NPM packages. They can of course be used separately or be modified to suit your needs.

But they're *built to work together out of the box* to make everything as easy as possible for you to compile JSX components so that XP can find and use them, insert editorial data into the XP components, use isomorphic serverside and clientside rendering and hydration, and optimize and serve reusable asset chunks to the client side.

This starter handles the full setup.


== Create project

o setup a project locally, run the following command:

  enonic project create -r starter-react4xp

Remember to create a *new XP sandbox* when completing the project wizard.

NOTE: *Don't have the Enonic CLI?* Visit the https://developer.enonic.com/start[Getting started guide] to install it.


== Project structure

The project folder created should now contain a project structure, looking something like this:

[source,files]
----
build.gradle <--1-->
settings.gradle
package.json <--2-->
build/ <--3-->
src/
  main/
    resources/
      assets/ <!--4-->
      react4xp/ <!--5-->
        _entries <!--6-->
      site/
        parts/ <!--7-->
        pages/
      webapp/ <!--8-->

----

image::hello-dummy.png["Logging in, opening apps and launching webapp" width=1024px]

<1> The gradle files are used by the build system. The starter adds some setup here: the library lib-react4xp is imported, and some building steps are triggered, putting everything together (using webpack with configurations that are fetched with NPM).
<2> package.json sets up NPM package import
<3> build/ contains output files produced by the build. All the output from the react4xp build process will be put in the subfolder build/resources/main/assets/react4xp...
<4> ...but notably, assets/react4xp is NOT the source of the built React4xp assets. Just use assets/ as before: for general static assets such as css and icons, not react4xp components.
<5> react4xp/ is the general folder for react component source files. React4xp will look for .js and .jsx files here and in all subfolders, and compile them during build. All subfolders below this (except for _entries) will be compiled to *chunks* with the same name as the subfolder. Put nested/reused react components in subfolders like that, and also other code imported by your components.
<6> react4xp/_entries is the main folder for *entry components* - react components that can be used by XP through react4xp (i.e., don't need to be referred to (and nested in) other react components.
<7> Below the parts/ and pages/ subfolders is where you put your XP parts and pages. You can also put JSX entry components together with your parts and pages. If they have the same name as the part/page, they are super easy to inject into the part/page from the controller.
<8> Folder containing the root webapp http controller. React4xp also supplies services that make it easy to inject react components into standalone webapp pages - in principle not even the controller is needed!

== Building and Deploying

To build and deploy the app, run this command from your shell:

  enonic project deploy

Accept starting the sandbox

[NOTE]
====
To verify that your app started successfully, you should find an entry similar to this in the sandbox log:

  2019-04-09 13:40:40,765 INFO ... Application [<name.of.your.app>] installed successfully
====


== API/Details

Bla bla, basic info and links about how react/react4XP works and what it does.


== Usage

This section contains a few examples on how you can setup and build something something..

=== Example A - Cool title

=== Example B - (title)

To see your current application:

. log in to the XP admin console (http://localhost:8080)
. open the "Applications" app, and select the listed applications
. visit the app by clicking the web app link.

video::webapp.mp4["Logging in, opening apps and launching webapp" width=1024px]


==== JS Controller

The essense of a web application is the controller.
In your project, you will find the following file:

.src/main/resources/webapp/webapp.js
[source,js]
----
exports.get = function (req) {
  var title = "Hello Web app";
  return  {
  body: `
<html>
  <head>
    <title>${title}</title>
    <link rel="stylesheet" type="text/css" href="styles.css"/>
  </head>
  <body>
      <h1>Sweet, "${title}" is working!</h1>
      <img src="html5logo.svg"/>
  </body>
</html>
`
  }
};
----

This controller file is automatically executed when your web app is being accessed.

The example above is also referencing two asset files.
These files can be found in the `src/main/resources/assets/` folder of your project.

[NOTE]
====
By default, the web app engine automatically serves files placed in the `asset/` as if they were located in the root of your web app.
====

=== Example 3 - Using Views

According to the MVC (Model View Controller) pattern,
we should separate the View (template) from the controller.
Enonic XP supports a variety of templating engines.
In this step, we'll use https://market.enonic.com/vendors/enonic/thymeleaf-lib[Thymeleaf]:

. To make sure Thymeleaf is available for our project, we must update the `gradle.build` file.
Uncomment the following line from the "dependencies" section:
+
      include "com.enonic.lib:lib-thymeleaf:2.0.0-RC1"
+
. Create a new file `hello.html` and add it to the `webapp/` folder
+
.src/main/resources/webapp/hello.html
[source,html]
----
include::../code-samples/webapp-template/hello.html[]
----
+
. Then update your controller file to use the new template:
+
.src/main/resources/webapp/webapp.js
[source,js]
----
include::../code-samples/webapp-template/webapp.js[]
----
+
. When finished, redeploy the app. NB! Just start a new shell if your current shell is running the sandbox:
+
  enonic project deploy
+

Refresh your app, and you should see the heading "*Sweet... Views are working too!*".

[TIP]
====
A cool feature related to Thymeleaf templates is that they are actually pure HTML.
Meaning they may be opened directly in your browser.
Try opening the hello.html file to see for yourself:
====

image::hello-dummy.png["Screenshot of template showing dummy heading and html5 logo",width=800px]

== Error handling

You might have noticed the "404 FTW" link in your app by now, and maybe even clicked it?
Essentially, the this url is not handled by the router, and returns the default error page.

We can do better, as XP provides a concept for generic http error handling. Lets add error handling to our app:

. Add a new controller `error.js` to your project as follows:
+
.src/main/resources/error/error.js
[source,js]
----
include::../code-samples/error/error.js[]
----
+
. Build, deploy and try out your new error handler:
+
  enonic project deploy
+


== Logging

While developing an app, it can be helpful to do some logging.
Try adding the following line into the exports.get section of your webapp controller and see what happens:

  log.info('Testing logging: %s', JSON.stringify(req, null, 4));

NOTE: A simplified logging function and many more are included in the https://market.enonic.com/vendors/enonic/util-lib[Util Library]
