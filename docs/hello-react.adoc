= Hello React - server and clientside rendering
:toc: right
:imagesdir: media/

In this chapter you will learn how XP controllers can use React templates - for both server-side and client-side rendering


TODO: Install HMDB demo app instead?

== Create a site

. Visit `localhost:8080/admin`. Log in to XP and open Content Studio.
+
. Create a new content project called `r4xp`
. Then, create a Site within this project - call it ´Tutorial´
. Add your React4xp app to the site.
+
After saving, you should see something like this:
+
image:hello_cs.png[title="Editing site in Content Studio: Hello React4XP!.", width=720px]

TODO: New screenshot


[[hello_output]]
== The output

Back to the actual rendering of HTML. Looking at the page source code, you should see the following:

TIP: The links have been shortened for better readability

[source,html]
----
<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <script defer src=".../react4xp/globals.js"></script>                            // <1>
  <script defer src=".../react4xp/runtime.js"></script>                            // <2>
  <script defer src=".../react4xp/hello-react.js"></script> // <3>
  <script defer src=".../react4xp/client-QZN5J5VC.global.js"></script>             // <4>
  <script data-react4xp-app-name="com.enonic.app.samples_react4xp" data-react4xp-ref="react4xpApp" type="application/json">{"command":"hydrate","devMode":false,"hasRegions":0,"isPage":1,"jsxPath":"site/pages/hello-react/hello-react","props":{}}</script> // <5>
</head>
<body class="xp-page">

    <div id="react4xpApp">
        <div data-reactroot="">                                                                       // <6>
            <h1>Hello React4XP</h1>
        </div>
    </div>

    <script defer src=".../react4xp/executor-BL4RRDZO.js"></script>                // <7>
</body>
</html>
----

The result is the HTML string we passed to the  `render` request of our initial controller - but *a lot of stuff* has also been inserted.

<1> `globals.<contenthash>.js` is react and react-dom bundled together. For improved security, they are served from XP instead of a random CDN.
<2> `runtime.js` containst chunked boilerplate code to run entries.
<3> `hello-react.js` is the compiled version of _hello-react.tsx_
<4> `client-QZN5J5VC.global.js` is the client-wrapper. TODO: What does it do?
<5> Properties and props needed for the client-side rendering to work properly (pun intended)
<6> The `<div id="react4xpApp">` target container, now filled with a server-side rendering of the react component
<7> Script that triggers `hydration` - more on this in the next chapter

NOTE: Most of these static assets are content-hashed, and optimized for client-side caching - thus running a CDN in front of XP in production will speed up the delivery.


== React template

Right of the bat, start by adding a React component (tsx) file to your project:

TODO: Place elsewhere

./src/main/resources/react4xp/entries/hello-react.tsx
[source,TSX]
----
include::../src/main/resources/react4xp/entries/hello-react.tsx[]
----

<1> React component that will render "Hello React4XP!"
<2> The `export default` line is required, it _may_ take a props object and _must_ return a react component.

This component will be executed, and rendered server-side.

=== XP controller

To trigger the rendering, we'll use a standard Enonic controller (ts). Add the following file to your app:

TODO: This whould now using mappings + app.ts

./src/main/resources/controllers/hello-react.ts
[source,TypeScript]
----
include::../code-samples/hello-react.ts[]
----

<1> Standard XP controller implemeting the HTTP get function.
<2> ID for the react app (TODO)
<3> React templates placed in `src/resources/main/react4xp/entries` may simply be referenced by their name, using a concept we call <<appendix/jsxpath#, jsxPath>>).
<4> The output of React4XP render() is a regular https://developer.enonic.com/docs/xp/stable/framework/http[XP response object].
<5> Bootstrap markup for the React application 


=== Controller mapping

TODO: This should be just a note, telling how app.ts is kickstarted.

By adding a mapping to `site.xml` - our controller will be invoked for sites where the application is deployed:

./src/main/resources/site/site.xml
[source,XML]
----
include::../src/main/resources/site/site.xml[]
----



== Next

What a start, coming up, let's make the component come alive on the <<hydration#, client side>> as well.